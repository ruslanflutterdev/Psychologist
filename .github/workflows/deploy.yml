name: Flutter Web Deploy to GitHub Pages

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  build_and_deploy:
    runs-on: ubuntu-latest

    steps:
      - name: üì¶ Checkout repository
        uses: actions/checkout@v4

      - name: ‚öôÔ∏è Setup Flutter SDK
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.35.6'

      - name: üñ•Ô∏è Build Flutter Web (Release)
        run: flutter build web --release

      - name: üìÑ Adjust base href in index.html
        run: |
          # –≠—Ç–æ—Ç —à–∞–≥ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ base href —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –¥–ª—è GitHub Pages,
          # –≥–¥–µ URL –∏–º–µ–µ—Ç —Ñ–æ—Ä–º–∞—Ç: https://<username>.github.io/<repository-name>/
          REPO_NAME=$(echo $GITHUB_REPOSITORY | cut -d '/' -f 2)
          # –ó–∞–º–µ–Ω—è–µ–º <base href="/"> –Ω–∞ <base href="/<repository-name>/">
          sed -i 's|<base href="/">|<base href="/'"$REPO_NAME"'/">|' build/web/index.html

      - name: üöÄ Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: build/web
          publish_branch: gh-pages
          # –í–∫–ª—é—á–∞–µ–º force_orphan, —á—Ç–æ–±—ã –æ—á–∏—â–∞—Ç—å —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã
          force_orphan: true
          # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º commit message
          commit_message: Deploy Flutter Web build from GitHub Actions
